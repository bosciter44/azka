<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZKA_SERVER_V3_STABLE</title>
    <style>
        :root { --neon: #39FF14; --bg: #000; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; padding: 20px; margin: 0; }
        .container { max-width: 800px; margin: auto; border: 2px solid var(--neon); padding: 20px; box-shadow: 0 0 20px rgba(57, 255, 20, 0.3); }
        .header { text-align: center; border-bottom: 2px solid var(--neon); padding-bottom: 10px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .slot { border: 1px dashed var(--neon); height: 150px; display: flex; align-items: center; justify-content: center; background: #0a0a0a; cursor: pointer; overflow: hidden; position: relative; }
        .slot img { width: 100%; height: 100%; object-fit: cover; }
        textarea { width: 100%; background: #000; color: var(--neon); border: 1px solid var(--neon); padding: 15px; box-sizing: border-box; font-family: inherit; margin-bottom: 15px; }
        .btn { width: 100%; background: transparent; color: var(--neon); border: 2px solid var(--neon); padding: 15px; cursor: pointer; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; transition: 0.3s; }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon); }
        #terminal { margin-top: 20px; border: 1px solid var(--neon); background: #050505; padding: 15px; min-height: 150px; white-space: pre-wrap; font-size: 13px; }
        .loader { color: yellow; display: none; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>[ AZKA_STABLE_V3 ]</h1></div>
    
    <div class="grid">
        <div class="slot" onclick="sel(0)">UPLOAD_01</div>
        <div class="slot" onclick="sel(1)">UPLOAD_02</div>
    </div>

    <input type="file" id="f0" hidden onchange="pv(event, 0)">
    <input type="file" id="f1" hidden onchange="pv(event, 1)">

    <textarea id="cmd" rows="2" placeholder="> MASUKKAN PERINTAH (Contoh: Analisis kedua foto ini)"></textarea>
    <button class="btn" onclick="execute()">PROSES SEKARANG</button>

    <div id="terminal">
        <div id="ld" class="loader">> BYPASSING_ERRORS... CONNECTING_TO_STABLE_V1_CORE...</div>
        <div id="out">> SYSTEM_READY. AWAITING_INPUT.</div>
    </div>
</div>

<script type="module">
    // MENGGUNAKAN VERSI SDK PALING STABIL
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // API KEY BARU KAMU YANG DARI SCREENSHOT (Ld18/NIbM)
    const API_KEY = "AIzaSyBCWzoYc4sXm-tbreqy2ga5jgaBXoGNIbM";
    const genAI = new GoogleGenerativeAI(API_KEY);

    window.sel = (i) => document.getElementById(`f${i}`).click();
    window.pv = (e, i) => {
        const file = e.target.files[0];
        if (file) {
            const r = new FileReader();
            r.onload = (ev) => document.querySelectorAll('.slot')[i].innerHTML = `<img src="${ev.target.result}">`;
            r.readAsDataURL(file);
        }
    };

    window.execute = async () => {
        const out = document.getElementById('out');
        const ld = document.getElementById('ld');
        const prompt = document.getElementById('cmd').value;
        const files = [document.getElementById('f0').files[0], document.getElementById('f1').files[0]].filter(Boolean);

        if (files.length === 0) return alert("Hacker, upload minimal 1 foto!");

        ld.style.display = "block";
        out.innerHTML = "";

        try {
            // FORCE MENGGUNAKAN VERSI STABIL GEMINI 1.5 FLASH
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

            const parts = await Promise.all(files.map(async (f) => {
                const b64 = await new Promise(r => {
                    const reader = new FileReader();
                    reader.onload = () => r(reader.result.split(',')[1]);
                    reader.readAsDataURL(f);
                });
                return { inlineData: { data: b64, mimeType: f.type } };
            }));

            const result = await model.generateContent([prompt || "Analisis foto ini", ...parts]);
            const response = await result.response;
            
            ld.style.display = "none";
            out.innerHTML = `[ SUCCESS ]\n\n${response.text()}`;

        } catch (err) {
            ld.style.display = "none";
            out.innerHTML = `[ ERROR ]\n${err.message}\n\nSaran: Jika masih 404, tunggu 5 menit agar Google mengaktifkan API Key baru kamu di server mereka.`;
        }
    };
</script>

</body>
</html>
